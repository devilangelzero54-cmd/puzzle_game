<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚ã„ã£ç‹ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
    body {
      font-family: system-ui, sans-serif;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 16px;
      box-sizing: border-box;
      margin: 0;
      text-align: center;
      background: url('images/background.png') no-repeat center top;
      background-size: cover;
    }

    .wrapper {
      max-width: 320px;          /* ã‚¹ãƒãƒ›å‘ã‘ã®æ¨ªå¹… */
      margin: 220px auto 40px;   /* ä¸Šã‚’å¤§ãã‚ã«ç©ºã‘ã¦å§ªã£ç‹ã®ä¸‹ã«é…ç½® */
      text-align: center;
    }

    /* --- ã‚¿ã‚¤ãƒˆãƒ« --- */
    .game-title {
      font-size: 22px;
      font-weight: bold;
      color: #ff8fb3;
      text-shadow: 0 0 4px #fff;
      margin-top: -12px;
      margin-bottom: 12px;
    }

    /* --- ç›¤é¢ + å®Œæˆå›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ --- */
    .board-wrapper {
      position: relative;
      width: 320px;
      height: 320px;
      margin: 0 auto 16px;
    }

    .board {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 2px;
      background: #444;
      padding: 2px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      touch-action: manipulation;
    }

    .tile {
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      border-radius: 4px;
      box-sizing: border-box;
      cursor: pointer;
    }

    .tile.blank {
      background-image: url("images/kuhaku.png");
      cursor: default;
    }

    /* ã‚¯ãƒªã‚¢å¾Œã«ä¸Šã‹ã‚‰ã‹ã¶ã›ã‚‹å®Œæˆå›³ */
    .clear-image {
      position: absolute;
      inset: -10px;          /* ç›¤é¢ã‚ˆã‚Šä¸€å›ã‚Šå¤§ãã (320â†’340px) */
      display: none;
      pointer-events: none;  /* ã‚¿ãƒƒãƒ—ã‚’é‚ªé­”ã—ãªã„ã‚ˆã†ã« */
    }

    .clear-image img {
      width: 340px;
      height: 340px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.35);
    }

    /* --- ãƒœã‚¿ãƒ³å‘¨ã‚Š --- */
    .controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    button {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: #3a8dde;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    button:active {
      opacity: 0.8;
    }

    /* æ¬¡ã¸ãƒœã‚¿ãƒ³ã ã‘å°‘ã—ä½™ç™½è¿½åŠ  */
    #nextBtn {
      margin-bottom: 8px;
      display: none;   /* JS ã‹ã‚‰å‡ºã™ã®ã§åˆæœŸã¯éè¡¨ç¤º */
    }

    /* --- ä¸‹ã®èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ --- */
    .info {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
      color: #333;
    }

    /* ä½¿ã£ã¦ã„ãªã„æ—§ preview ã®éè¡¨ç¤ºï¼ˆä¿é™ºï¼‰ */
    #preview {
      display: none;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1 class="game-title">ã‚ã„ã£ç‹ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ« 7</h1>

    <!-- ç›¤é¢ï¼‹ã‚¯ãƒªã‚¢ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="board-wrapper">
      <div id="board" class="board"></div>

      <!-- â˜… ã‚¯ãƒªã‚¢æ™‚ã«ä¸Šã‹ã‚‰ã‹ã¶ã›ã‚‹å®Œæˆå›³ -->
      <div id="clearImage" class="clear-image">
        <!-- ãƒ•ã‚¡ã‚¤ãƒ«åã¯å®Ÿéš›ã®å®Œæˆå›³ã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ã­ -->
        <img src="images/puzzle_007.png" alt="å®Œæˆå›³" />
      </div>
    </div>

    <!-- ã‚·ãƒ£ãƒƒãƒ•ãƒ« / ãƒªã‚»ãƒƒãƒˆ -->
    <div class="controls">
      <button id="shuffleBtn">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <!-- ã‚¯ãƒªã‚¢ã—ãŸã‚‰å‡ºã¦ãã‚‹ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ -->
    <button id="nextBtn">æ¬¡ã¸</button>

    <div class="info" id="infoText">
      ã‚¿ã‚¤ãƒ«ã‚’ã‚¹ãƒ¯ã‚¤ãƒ—æ„Ÿè¦šã§ã‚¿ãƒƒãƒ—ã—ã¦å‹•ã‹ã—ã¦ã­ã€‚
    </div>
  </div>

  <script>
    const SIZE      = 4;   // 4Ã—4
    const BLANK_ID  = 16;  // 16ç•ªã‚’ç©ºç™½æ‰±ã„ã«ã™ã‚‹

    const boardEl    = document.getElementById("board");
    const infoText   = document.getElementById("infoText");
    const nextBtn    = document.getElementById("nextBtn");
    const clearImage = document.getElementById("clearImage");

    // tiles é…åˆ—ã¯ã€Œç¾åœ¨ã®ä¸¦ã³ã€ã‚’è¡¨ã™ï¼ˆ1ã€œ16ï¼‰
    let tiles = [];

    // ç”»åƒãƒ‘ã‚¹ã‚’è¿”ã™ï¼ˆç•ªå· â†’ ãƒ•ã‚¡ã‚¤ãƒ«åï¼‰
    function getImagePath(id) {
      if (id === BLANK_ID) {
        return "images/kuhaku.png";
      }
      // 1 â†’ puzzle7_001.jpg, 2 â†’ puzzle7_002.jpg â€¦ ã¨ã„ã†å‰æ
      const num = String(id).padStart(3, "0");
      return `images/puzzle7_${num}.jpg`;
    }

    // ç›¤é¢ã‚’HTMLã«æç”»
    function render() {
      boardEl.innerHTML = "";
      tiles.forEach((id, index) => {
        const tile = document.createElement("div");
        tile.className = "tile";

        if (id === BLANK_ID) {
          tile.classList.add("blank");
        } else {
          tile.style.backgroundImage = `url("${getImagePath(id)}")`;
        }

        tile.dataset.index = index;
        tile.addEventListener("click", onTileClick);
        boardEl.appendChild(tile);
      });
    }

    // ã‚¿ã‚¤ãƒ«ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã¨ãã®å‡¦ç†
    function onTileClick(e) {
      const index      = Number(e.currentTarget.dataset.index);
      const blankIndex = tiles.indexOf(BLANK_ID);

      if (!isAdjacent(index, blankIndex)) {
        return; // éš£ã‚Šåˆã£ã¦ã„ãªã„ãªã‚‰å‹•ã‹ã•ãªã„
      }

      // ã‚¿ãƒƒãƒ—ã—ãŸã‚¿ã‚¤ãƒ«ã¨ç©ºç™½ã‚’å…¥ã‚Œæ›¿ãˆ
      [tiles[index], tiles[blankIndex]] = [tiles[blankIndex], tiles[index]];
      render();

      if (isSolved()) {
        infoText.textContent = "å®Œæˆï¼ãŠã‚ã§ã¨ã†ğŸ‰";
        nextBtn.style.display    = "inline-block"; // æ¬¡ã¸ãƒœã‚¿ãƒ³è¡¨ç¤º
        clearImage.style.display = "block";        // å®Œæˆå›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
      }
    }

    // index1 ã¨ index2 ãŒä¸Šä¸‹å·¦å³ã§éš£æ¥ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    function isAdjacent(i1, i2) {
      const r1 = Math.floor(i1 / SIZE);
      const c1 = i1 % SIZE;
      const r2 = Math.floor(i2 / SIZE);
      const c2 = i2 % SIZE;
      const dr = Math.abs(r1 - r2);
      const dc = Math.abs(c1 - c2);
      return (dr + dc === 1); // ãƒãƒ³ãƒãƒƒã‚¿ãƒ³è·é›¢1ãªã‚‰éš£
    }

    // å®Œæˆã—ã¦ã„ã‚‹ã‹ã©ã†ã‹
    function isSolved() {
      for (let i = 0; i < SIZE * SIZE; i++) {
        if (tiles[i] !== i + 1) return false;
      }
      return true;
    }

    // 1ã€œ15 ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹ã¦ã€è§£ã‘ã‚‹é…ç½®ã ã‘æ¡ç”¨
    function shuffleTiles() {
      const arr = [];
      for (let i = 1; i < BLANK_ID; i++) {
        arr.push(i);
      }

      do {
        // ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼â€“ã‚¤ã‚§ãƒ¼ãƒ„ã®ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
      } while (!isSolvable(arr));

      // 15æšåˆ†ã‚’ã‚»ãƒƒãƒˆã—ã¦ã€æœ€å¾Œã«ç©ºç™½ã‚’ç½®ã
      tiles = arr.concat(BLANK_ID);
    }

    // ã“ã®ä¸¦ã³ãŒè§£ã‘ã‚‹ãƒ‘ã‚ºãƒ«ã‹ã©ã†ã‹ï¼ˆ4Ã—4ç”¨ï¼‰
    function isSolvable(arr) {
      // 4Ã—4 ã§ç©ºç™½ãŒä¸€ç•ªå³ä¸‹ã«ã‚ã‚‹ã‚±ãƒ¼ã‚¹ã§ã¯ã€
      // åè»¢æ•°ãŒã€Œå¶æ•°ã€ãªã‚‰è§£ã‘ã‚‹
      let inv = 0;
      for (let i = 0; i < arr.length; i++) {
        for (let j = i + 1; j < arr.length; j++) {
          if (arr[i] > arr[j]) inv++;
        }
      }
      return inv % 2 === 0;
    }

    // å®ŒæˆçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ
    function resetTiles() {
      tiles = [];
      for (let i = 1; i <= SIZE * SIZE; i++) {
        tiles.push(i);
      }
    }

    // åˆæœŸåŒ–
    function init() {
      resetTiles();  // ã¾ãšå®ŒæˆçŠ¶æ…‹
      render();

      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      document.getElementById("shuffleBtn").addEventListener("click", () => {
        shuffleTiles();
        render();
        infoText.textContent = "ã‚·ãƒ£ãƒƒãƒ•ãƒ«å®Œäº†ï¼ãã‚ãˆã¦ã¿ã¦ã­ã€‚";
        nextBtn.style.display    = "none";
        clearImage.style.display = "none";
      });

      // ãƒªã‚»ãƒƒãƒˆ
      document.getElementById("resetBtn").addEventListener("click", () => {
        resetTiles();
        render();
        infoText.textContent = "ãƒªã‚»ãƒƒãƒˆã—ãŸã‚ˆã€‚";
        nextBtn.style.display    = "none";
        clearImage.style.display = "none";
      });

      // æ¬¡ã¸ãƒœã‚¿ãƒ³ï¼špuzzle7.html ã«ç§»å‹•
      nextBtn.addEventListener("click", () => {
        location.href = "puzzle7.html";
      });
    }

    init();
  </script>
</body>
</html>
